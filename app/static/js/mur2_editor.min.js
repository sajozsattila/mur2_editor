var g_view="html",g_focusmode_switch=!1,g_preview_on=!0,g_selectedTextarea=null;function g_domSetHighlightedContent(e,t,i){var a=document.getElementById(e),r=null;return"none"===i?a.innerHTML=t:window.hljs?(r=window.hljs.highlight(i,t),a.innerHTML=r.value):a.textContent=t,r}function g_domFindScrollMarks(){for(var e,t=document.querySelectorAll("#article_main .line"),i=[],a=[0],r=[0],n=0,l=t.length;n<l;n++)(e=parseInt(t[n].getAttribute("data-line")))&&(i[e]=Math.round(t[n].offsetTop));var o=document.querySelectorAll(".ldt-pre .block-start");for(l=o.length,e=0,n=0;n<l;n++){var s=parseInt(o[n].getAttribute("data-line"));s&&void 0!==i[e+=s]&&(a.push(o[n].offsetTop),r.push(i[e]))}var c=document.querySelector(".ldt-pre").scrollHeight,d=a[a.length-1];return a.push(c-5>d?c-5:d),r.push(document.querySelector("#article_main").scrollHeight),[a,r]}!function(e,t){"use strict";var i=g_domFindScrollMarks,a=e.getElementById("title-source"),r=(e.getElementById("article_title"),e.getElementById("abstact-source")),n=(e.getElementById("article_abstract_text"),e.getElementById("main-source")),l=e.getElementById("article_main"),o=e.querySelector('meta[name="article_id"]').content,s=debounce(function(){h.recalcHeight()},100),c=new ScrollMap(i),d=new ImagePreloader,u=new ImageLoader(d,"https:"===location.protocol?"https:":"http:","m_"),m=new ParserCollection(t.markdownit,function(e){c.reset();try{localStorage.setItem("mur2_main_content"+o,e),localStorage.setItem("mur2_main_content"+o+"_time",+new Date)}catch(e){}},"article_main","article_main_pre",function(){return n.value},u),f=new ImageLoader(new ImagePreloader,"https:"===location.protocol?"https:":"http:","t_"),g=new ParserCollection(t.markdownit,function(e){try{localStorage.setItem("mur2_title_content"+o,e.split("\n").slice(2,-3).join("\n")),localStorage.setItem("mur2_title_content"+o+"_time",+new Date)}catch(e){}},"article_title","article_title",function(){return'<span id="article_title">\n\n'+a.value.replace(/(?:\r\n|\r|\n)/g,"")+"\n\n</span>\n"},f),p=new ImageLoader(new ImagePreloader,"https:"===location.protocol?"https:":"http:","a_"),v=new ParserCollection(t.markdownit,function(e){try{localStorage.setItem("mur2_abstract_content"+o,e.split("\n").slice(2,-3).join("\n")),localStorage.setItem("mur2_abstract_content"+o+"_time",+new Date)}catch(e){}},"article_abstract_text","article_abstract_text",function(){return'<span id="article_abstract">\n\n'+r.value+"\n\n</span>\n"},p);m.updateResult(u,!0),v.updateResult(p,!0),g.updateResult(f,!0),collapsible_listener();var h=new TextareaDecorator(n,mdParser),w=e.getElementsByClassName("ldt")[0],y=new SyncScroll(c,new Animator(function(){return w.scrollTop},function(e){w.scrollTop=e}),new Animator(function(){return l.scrollTop},function(e){l.scrollTop=e}),w,l,e.querySelector('[id^="maintext"]')),b=debounce(m.updateResult,300,{maxWait:3e3}),E=debounce(g.updateResult,300,{maxWait:3e3}),L=debounce(v.updateResult,300,{maxWait:3e3});let I=e.querySelector("#article_input_side");["input","conv"].forEach(e=>I.addEventListener(e,e=>{var t;t="input"==e.type?e.target.id:e.detail;var i=g_preview_on;switch(g_selectedTextarea=t,t){case"title-source":i&&E(f,!1);break;case"abstact-source":i&&L(p,!1);break;case"main-source":i&&b(u,!1)}})),n.addEventListener("touchstart",y.switchScrollToSrc),n.addEventListener("mouseover",y.switchScrollToSrc),l.addEventListener("touchstart",y.switchScrollToResult),l.addEventListener("mouseover",y.switchScrollToResult),y.switchScrollToSrc(),function(){var i,a=e.querySelector("#slider"),r=new Draggabilly(a,{axis:"x"}),n=e.getElementById("article_input_side"),l=e.getElementById("article_preview_side");function o(e){n.style.width="calc("+e+"% - 3px)",l.style.width="calc("+(100-e)+"% - 3px)",c.reset(),s()}a.addEventListener("dblclick",function(){o(50)}),r.on("dragStart",function(e,a,r){i=t.innerWidth}),r.on("dragMove",function(e,t,a){o(100*t.pageX/i)})}(),t.addEventListener("resize",function(){c.reset(),s()});for(var k=["select","click"],T=k.length;T--;)I.addEventListener(k[T],e=>{let t=e.target;"title-source"!==t.id&&"abstact-source"!==t.id&&"main-source"!==t.id||(g_selectedTextarea=t.id,g_focusmode_switch&&h.update())});var S=new Event("input");function B(){var e=g_selectedTextarea;"main-source"===e?(b(u,!1),n.dispatchEvent(S)):"title-source"===e?E(f,!1):"abstact-source"===e&&L(p,!1)}e.getElementById("fileElem").addEventListener("change",function(){if(this.files&&FileReader){var t=new FileReader,i=this;t.onload=function(){var t=this.result,l=e.createElement("div");l.innerHTML=t;var o=e.createDocumentFragment();o.appendChild(l);var s=o.getElementById("article_title"),c=o.getElementById("article_abstract");r.value=c.innerHTML,a.value=s.innerHTML.replace("\n",""),s.parentNode.removeChild(s),c.parentNode.removeChild(c),n.value=o.textContent.replace(/^\s+/g,""),b(u,!0),n.dispatchEvent(S),h.update(),i.value=i.defaultValue,o=null,E(f,!0),L(p,!0)},t.readAsText(this.files[0])}}),e.getElementById("feaImg_add").addEventListener("change",function(){if(this.files&&FileReader){var t=e.getElementById("feaImg_add").files[0],i=new FileReader;i.onload=function(){var t=e.getElementById("article_abstract_div").firstElementChild;t.src=i.result,t.classList.remove("hide"),localStorage.setItem("mur2_featured_image"+o,t.src),localStorage.setItem("mur2_featured_image"+o+"_time",+new Date.getUTCDate)},i.readAsDataURL(t)}}),e.querySelector("#id_featureImage").addEventListener("click",function(){if("feaImg_del"==event.target.id){var t=e.getElementById("article_abstract_div").firstElementChild;t.src="",t.classList.add("hide"),localStorage.setItem("mur2_featured_image"+o,t.src),localStorage.setItem("mur2_featured_image"+o+"_time",+new Date)}}),e.querySelector("#menu").addEventListener("click",i=>{let a=i.target;if(a.classList.contains("choice_menu")){var r=a.id.replace("id_",""),l=e.getElementById("menu");l.classList.contains(r)?l.classList.remove(r):l.classList.add(r)}else if(a.classList.contains("choice_toolbar"))switch(a.id){case"id_upload":upload_source();break;case"id_download":download_result([m,v,g]);break;case"id_save":b(u,!0),E(f,!0),L(p,!0),save_article([m,v,g]);break;case"id_syntax_hl":var o=e.getElementById("id_syntax_hl");g_focusmode_switch?(o.classList.add("focusmode"),g_focusmode_switch=!1):(o.classList.remove("focusmode"),g_focusmode_switch=!0),n.dispatchEvent(S);break;case"id_hide_preview":var s=e.getElementById("article_preview_side"),c=e.getElementById("article_input_side");o=e.getElementById("id_hide_preview");s.classList.contains("previewoff")?(s.classList.remove("previewoff"),c.classList.remove("previewoff"),o.classList.remove("previewoff"),g_preview_on=!0,b(u,!0),E(f,!0),L(p,!0)):(s.classList.add("previewoff"),c.classList.add("previewoff"),o.classList.add("previewoff"),g_preview_on=!1);break;case"id_hide_input":s=e.getElementById("article_preview_side"),c=e.getElementById("article_input_side"),o=e.getElementById("id_hide_input");c.classList.contains("inputoff")?(s.classList.remove("inputoff"),c.classList.remove("inputoff"),o.classList.remove("inputoff")):(s.classList.add("inputoff"),c.classList.add("inputoff"),o.classList.add("inputoff"));break;case"id_show_title":for(var d=e.querySelectorAll("#article_preview_side, #article_input_side"),h=(o=e.getElementById("id_show_title"),d.length);h--;)d[h].classList.contains("titleon")?(d[h].classList.remove("titleon"),o.classList.remove("titleon")):(d[h].classList.add("titleon"),o.classList.add("titleon"));break;case"id_proof":if("main-source"===g_selectedTextarea){var w=e.getElementById(g_selectedTextarea),y=w.selectionStart,I=w.selectionEnd,k=e.getElementById("editorModal"),T=e.getElementById("modalClose");e.getElementsByClassName("modal-body")[0].innerHTML='<iframe id="editor_iframe" allowTransparency="true" frameborder="0" scrolling="yes"  src="/embedding" type= "text/javascript"></iframe>',k.style.display="block",T.onclick=function(){var t=e.getElementById("editor_iframe"),i=t.contentWindow.document.getElementById("selected");if(i.innerHTML.length>0){var a=w.value.substring(y,I);0===a.length&&(a=t.contentWindow.document.getElementById("selected_title").innerHTML);var r=t.contentWindow.document.getElementById("myList").value;w.value=w.value.substring(0,y)+'<button type="button" class="collapsible">'+a+'</button><div class="iframe_wrap"><iframe scrolling="no" relationtype="'+r+'" src="/iframe/'+i.innerHTML+'"></iframe><a href="/reader/'+i.innerHTML+'">'+_("Full text")+"</a></div>"+w.value.substring(I),w.focus(),w.select(),w.selectionStart=I,w.selectionEnd=I,B()}k.style.display="none"},t.onclick=function(e){e.target==k&&(k.style.display="none",w.focus(),w.select(),w.selectionStart=y,w.selectionEnd=I)}}break;case"id_head":editorToolbarAction("heading"),B();break;case"id_italic":editorToolbarAction("italic"),B();break;case"id_strong":editorToolbarAction("strong"),B();break;case"id_picture":editorToolbarAction("picture"),B();break;case"id_link":editorToolbarAction("link"),B();break;case"id_list":editorToolbarAction("list"),B();break;case"id_nlist":editorToolbarAction("numbered_list"),B();break;case"id_footnote":editorToolbarAction("footnote"),B();break;case"id_table":editorToolbarAction("table"),B();break;case"id_code":editorToolbarAction("code"),B();break;case"id_latex":editorToolbarAction("latex"),B()}}),e.addEventListener("keydown",function(e){var t=void 0,i=[e.key,e.keyIdentifier,e.keyCode,e.which];for(;void 0===t&&i.length>0;)t=i.pop();if(t&&("115"==t||"83"==t)&&(e.ctrlKey||e.metaKey)&&!e.altKey)return e.preventDefault(),b(u,!0),E(f,!0),L(p,!0),save_article([m,v,g]),!1;return!0}),e.querySelector("#side_menu").addEventListener("click",i=>{let a=i.target;if(a.classList.contains("preview-format")){for(var r=a.id.replace("id_",""),n=e.body,l=n.className.split(" "),o=null,s=l.length;s--;)/result-as-*/.test(l[s])&&(o=l[s]);n.classList.remove(o),n.classList.add("result-as-"+r),g_view=r,E(f,!0),L(p,!0),b(u,!0)}else if("id_wpc_publish"===a.id)wordpress_on_fly(g,v,m);else if("id_medium_publish"===a.id)medium_on_fly(g,v,m);else if("id_medium_connect"===a.id)medium_connect();else if("id_rollback_article"===a.id)getArticleversion(),b(u,!0),E(f,!1),L(p,!1);else if("id_wpc_clear"===a.id)clear_cookies("wpc");else if("id_medium_clear"===a.id)clear_cookies("medium");else if("id_pdf"===a.id)generate_from_md("pdf",m);else if("id_latex_export"===a.id)generate_from_md("latex",m);else if("id_epub"===a.id)generate_from_md("epub",m);else if("id_msw"===a.id)generate_from_md("msw",m);else if("id_publish_article"===a.id){e.getElementById("transFrame").addEventListener("load",function(){t.location.reload(!0)})}})}(document,window);