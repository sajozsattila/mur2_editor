var g_view="html",g_focusmode_switch=!1,g_preview_on=!0,g_selectedTextarea="main-source",g_echange_on=!1;function g_domSetHighlightedContent(e,t,i){var a=document.getElementById(e),r=null;return"none"===i?a.innerHTML=t:window.hljs?(r=window.hljs.highlight(i,t),a.innerHTML=r.value):a.textContent=t,r}function g_domFindScrollMarks(){for(var e,t=document.querySelectorAll("#article_main .line"),i=[],a=[0],r=[0],n=0,l=t.length;n<l;n++)(e=parseInt(t[n].getAttribute("data-line")))&&(i[e]=Math.round(t[n].offsetTop));var s=document.querySelectorAll(".ldt-pre .block-start");for(l=s.length,e=0,n=0;n<l;n++){var o=parseInt(s[n].getAttribute("data-line"));o&&void 0!==i[e+=o]&&(a.push(s[n].offsetTop),r.push(i[e]))}var c=document.querySelector(".ldt-pre").scrollHeight,d=a[a.length-1];return a.push(c-5>d?c-5:d),r.push(document.querySelector("#article_main").scrollHeight),[a,r]}!function(e,t){"use strict";var i=g_domFindScrollMarks,a=e.getElementById("title-source"),r=(e.getElementById("article_title"),e.getElementById("abstact-source")),n=(e.getElementById("article_abstract_text"),e.getElementById("main-source")),l=e.getElementById("article_main"),s=e.querySelector('meta[name="article_id"]').content,o=debounce(function(){h.recalcHeight()},100),c=new ScrollMap(i),d=new ImagePreloader,u=new ImageLoader(d,"https:"===location.protocol?"https:":"http:","m_"),m=new ParserCollection(t.markdownit,function(e){c.reset();try{localStorage.setItem("mur2_main_content"+s,e),localStorage.setItem("mur2_main_content"+s+"_time",+new Date)}catch(e){}},"article_main","article_main_pre",function(){return n.value},u),g=new ImageLoader(new ImagePreloader,"https:"===location.protocol?"https:":"http:","t_"),f=new ParserCollection(t.markdownit,function(e){try{localStorage.setItem("mur2_title_content"+s,e.split("\n").slice(2,-3).join("\n")),localStorage.setItem("mur2_title_content"+s+"_time",+new Date)}catch(e){}},"article_title","article_title",function(){return'<span id="article_title">\n\n'+a.value.replace(/(?:\r\n|\r|\n)/g,"")+"\n\n</span>\n"},g),p=new ImageLoader(new ImagePreloader,"https:"===location.protocol?"https:":"http:","a_"),v=new ParserCollection(t.markdownit,function(e){try{localStorage.setItem("mur2_abstract_content"+s,e.split("\n").slice(2,-3).join("\n")),localStorage.setItem("mur2_abstract_content"+s+"_time",+new Date)}catch(e){}},"article_abstract_text","article_abstract_text",function(){return'<span id="article_abstract">\n\n'+r.value+"\n\n</span>\n"},p);m.updateResult(u,!0),v.updateResult(p,!0),f.updateResult(g,!0),collapsible_listener();var h=new TextareaDecorator(n,mdParser),b=e.getElementsByClassName("ldt")[0],y=new SyncScroll(c,new Animator(function(){return b.scrollTop},function(e){b.scrollTop=e}),new Animator(function(){return l.scrollTop},function(e){l.scrollTop=e}),b,l,e.querySelector('[id^="maintext"]')),w=debounce(m.updateResult,300,{maxWait:3e3}),E=debounce(f.updateResult,300,{maxWait:3e3}),L=debounce(v.updateResult,300,{maxWait:3e3});let I=e.querySelector("#article_input_side");["input","conv"].forEach(e=>I.addEventListener(e,e=>{var t;t="input"==e.type?e.target.id:e.detail;var i=g_preview_on;switch(g_selectedTextarea=t,t){case"title-source":i&&E(g,!1);break;case"abstact-source":i&&L(p,!1);break;case"main-source":i&&w(u,!1)}})),n.addEventListener("touchstart",y.switchScrollToSrc),n.addEventListener("mouseover",y.switchScrollToSrc),l.addEventListener("touchstart",y.switchScrollToResult),l.addEventListener("mouseover",y.switchScrollToResult),y.switchScrollToSrc(),function(){var i,a=e.querySelector("#slider"),r=new Draggabilly(a,{axis:"x"}),n=e.getElementById("article_input_side"),l=e.getElementById("article_preview_side");function s(e){n.style.width="calc("+e+"% - 3px)",l.style.width="calc("+(100-e)+"% - 3px)",c.reset(),o()}a.addEventListener("dblclick",function(){s(50)}),r.on("dragStart",function(e,a,r){i=t.innerWidth}),r.on("dragMove",function(e,t,a){s(100*t.pageX/i)})}(),t.addEventListener("resize",function(){c.reset(),o()});for(var B=["select","click"],k=B.length;k--;)I.addEventListener(B[k],e=>{let t=e.target;"title-source"!==t.id&&"abstact-source"!==t.id&&"main-source"!==t.id||(g_selectedTextarea=t.id,g_focusmode_switch&&h.update())});var T=new Event("input");function S(){var e=g_selectedTextarea;"main-source"===e?(w(u,!1),n.dispatchEvent(T)):"title-source"===e?E(g,!1):"abstact-source"===e&&L(p,!1)}function x(){console.log("save");try{localStorage.setItem("mur2_bib_content"+s,e.getElementById("bib-source").value),localStorage.setItem("mur2_bib_content"+s+"_time",+new Date)}catch(e){}}e.getElementById("fileElem").addEventListener("change",function(){if(this.files&&FileReader){var t=new FileReader,i=this;t.onload=function(){var t=this.result,l=e.createElement("div");l.innerHTML=t;var s=e.createDocumentFragment();s.appendChild(l);var o=s.getElementById("article_title"),c=s.getElementById("article_abstract");null!==c&&(r.value=c.innerHTML,c.parentNode.removeChild(c)),null!==o&&(a.value=o.innerHTML.replace("\n",""),o.parentNode.removeChild(o)),n.value=s.textContent.replace(/^\s+/g,""),w(u,!0),n.dispatchEvent(T),h.update(),i.value=i.defaultValue,s=null,E(g,!0),L(p,!0)},t.readAsText(this.files[0])}}),e.getElementById("feaImg_add").addEventListener("change",function(){if(this.files&&FileReader){var i=e.getElementById("feaImg_add").files[0],a=new FileReader;a.onload=function(){var i=e.getElementById("article_abstract_div").firstElementChild;i.src=a.result,i.classList.remove("hide"),localStorage.setItem("mur2_featured_image"+s,i.src);const r=(new t.Date).getUTCDate();localStorage.setItem("mur2_featured_image"+s+"_time",+r)},a.readAsDataURL(i)}}),e.querySelector("#id_featureImage").addEventListener("click",function(){if("feaImg_del"==event.target.id){var t=e.getElementById("article_abstract_div").firstElementChild;t.src="",t.classList.add("hide"),localStorage.setItem("mur2_featured_image"+s,t.src),localStorage.setItem("mur2_featured_image"+s+"_time",+new Date)}}),e.getElementById("pictureElem").addEventListener("change",function(){if(this.files&&FileReader){var t=new FileReader;t.onload=function(){e.getElementById("msg");var t=200;if(["jpg","jpeg","png","gif"].includes(a)){var r=new Blob([this.result],{type:"imgage/"+a}),n=new FormData;n.append("photo",r,i),n.append("mediapage",!1);var l=new XMLHttpRequest;l.open("post","/media",!0),l.send(n),l.onload=function(){if(200!=l.status)alert(_("Error: ")+l.statusText+" - "+l.response),t=l.status;else{var e=JSON.parse(l.response);editorToolbarAction("picture",e.url),S()}}}else t=400,alert(_("Error: ")+_("Not supported image format!"));msgclear(t)},t.readAsArrayBuffer(this.files[0]);var i=this.files[0].name,a=this.files[0].name.split(".").pop().toLowerCase()}}),e.getElementById("bibliography_file").addEventListener("change",function(){if(this.files&&FileReader){var t=new FileReader;t.onload=function(){e.getElementById("msg");var t=200;if(["bib"].includes(i)){var a=new Blob([this.result],{type:"text/plain"}),r=new FileReader;r.addEventListener("loadend",function(t){e.getElementById("bib-source").value=t.srcElement.result,x()}),r.readAsText(a)}else alert(_("Error: ")+_("Not supported file format!")),t=400;msgclear(t)},t.readAsArrayBuffer(this.files[0]);var i=this.files[0].name.split(".").pop().toLowerCase()}}),e.getElementById("bibliography").addEventListener("keypress",x),e.querySelector("#menu").addEventListener("click",i=>{let a=i.target;if(a.classList.contains("choice_menu")){var r=a.id.replace("id_",""),l=e.getElementById("menu");l.classList.contains(r)?l.classList.remove(r):l.classList.add(r)}else if(a.classList.contains("choice_toolbar"))switch(a.id){case"id_upload":upload_source();break;case"id_download":download_result([m,v,f]);break;case"id_save":w(u,!0),E(g,!0),L(p,!0),save_article([m,v,f]);break;case"id_syntax_hl":var s=e.getElementById("id_syntax_hl");g_focusmode_switch?(s.classList.add("focusmode"),g_focusmode_switch=!1):(s.classList.remove("focusmode"),g_focusmode_switch=!0),n.dispatchEvent(T);break;case"id_hide_preview":var o=e.getElementById("article_preview_side"),c=e.getElementById("article_input_side");s=e.getElementById("id_hide_preview");o.classList.contains("previewoff")?(o.classList.remove("previewoff"),c.classList.remove("previewoff"),s.classList.remove("previewoff"),g_preview_on=!0,w(u,!0),E(g,!0),L(p,!0)):(o.classList.add("previewoff"),c.classList.add("previewoff"),s.classList.add("previewoff"),g_preview_on=!1);break;case"id_hide_input":o=e.getElementById("article_preview_side"),c=e.getElementById("article_input_side"),s=e.getElementById("id_hide_input");c.classList.contains("inputoff")?(o.classList.remove("inputoff"),c.classList.remove("inputoff"),s.classList.remove("inputoff")):(o.classList.add("inputoff"),c.classList.add("inputoff"),s.classList.add("inputoff"));break;case"id_show_title":for(var d=e.querySelectorAll("#article_preview_side, #article_input_side"),h=(s=e.getElementById("id_show_title"),d.length);h--;)d[h].classList.contains("titleon")?(d[h].classList.remove("titleon"),s.classList.remove("titleon")):(d[h].classList.add("titleon"),s.classList.add("titleon"));break;case"id_proof":if("main-source"===g_selectedTextarea){var b=e.getElementById(g_selectedTextarea),y=b.selectionStart,I=b.selectionEnd,B=e.getElementById("editorModal"),k=e.getElementById("modalClose");e.getElementsByClassName("modal-body")[0].innerHTML='<iframe id="editor_iframe" allowTransparency="true" frameborder="0" scrolling="yes"  src="/embedding" type= "text/javascript"></iframe>',B.style.display="block",k.onclick=function(){var t=e.getElementById("editor_iframe"),i=t.contentWindow.document.getElementById("selected");if(i.innerHTML.length>0){var a=b.value.substring(y,I);0===a.length&&(a=t.contentWindow.document.getElementById("selected_title").innerHTML);var r=t.contentWindow.document.getElementById("myList").value;b.value=b.value.substring(0,y)+'<button type="button" class="collapsible">'+a+'</button><div class="iframe_wrap"><iframe scrolling="no" relationtype="'+r+'" src="/iframe/'+i.innerHTML+'"></iframe><a href="/reader/'+i.innerHTML+'">'+_("Full text")+"</a></div>"+b.value.substring(I),b.focus(),b.select(),b.selectionStart=I,b.selectionEnd=I,S()}B.style.display="none"},t.onclick=function(e){e.target==B&&(B.style.display="none",b.focus(),b.select(),b.selectionStart=y,b.selectionEnd=I)}}break;case"id_echange":!0!==g_echange_on?(e.getElementById("editor_changes").disabled=!1,g_echange_on=!0,e.getElementById("id_echange_botton").style.color="#c62641"):(e.getElementById("editor_changes").disabled=!0,g_echange_on=!1,e.getElementById("id_echange_botton").style.color="white");break;case"id_bib":o=e.getElementById("article_preview_side"),s=e.getElementById("id_bib");o.classList.contains("bibon")?(o.classList.remove("bibon"),s.classList.remove("bibon"),g_preview_on=!0,w(u,!0),E(g,!0),L(p,!0)):(o.classList.add("bibon"),s.classList.add("bibon"),g_preview_on=!1);break;case"id_ren":render_on_server();break;case"id_head":editorToolbarAction("heading"),S();break;case"id_italic":editorToolbarAction("italic"),S();break;case"id_strong":editorToolbarAction("strong"),S();break;case"id_picture":if("/editor"===t.location.pathname){var x=prompt(_("Please enter a URL for image."),"");null!=x&&(editorToolbarAction("picture",x),S())}else upload_picture();break;case"id_link":editorToolbarAction("link"),S();break;case"id_list":editorToolbarAction("list"),S();break;case"id_nlist":editorToolbarAction("numbered_list"),S();break;case"id_footnote":editorToolbarAction("footnote"),S();break;case"id_table":editorToolbarAction("table"),S();break;case"id_code":editorToolbarAction("code"),S();break;case"id_latex":editorToolbarAction("latex"),S();break;case"id_chat":e.getElementById("id_side_menu").checked=!0,e.getElementById("id_ec").checked=!0,msgnotice("hide")}}),e.addEventListener("keydown",function(e){var t=void 0,i=[e.key,e.keyIdentifier,e.keyCode,e.which];for(;void 0===t&&i.length>0;)t=i.pop();if(t&&("115"==t||"83"==t)&&(e.ctrlKey||e.metaKey)&&!e.altKey)return e.preventDefault(),w(u,!0),E(g,!0),L(p,!0),save_article([m,v,f]),!1;return!0}),e.querySelector("#side_menu").addEventListener("click",i=>{let a=i.target;if(a.classList.contains("preview-format")){for(var r=a.id.replace("id_",""),n=e.body,l=n.className.split(" "),s=null,o=l.length;o--;)/result-as-*/.test(l[o])&&(s=l[o]);n.classList.remove(s),n.classList.add("result-as-"+r),g_view=r,E(g,!0),L(p,!0),w(u,!0)}else if("id_wpc_publish"===a.id)wordpress_on_fly(f,v,m);else if("id_medium_publish"===a.id)medium_on_fly(f,v,m);else if("id_medium_connect"===a.id)medium_connect();else if("id_rollback_article"===a.id)getArticleversion(),w(u,!0),E(g,!1),L(p,!1);else if("id_wpc_clear"===a.id)clear_cookies("wpc");else if("id_medium_clear"===a.id)clear_cookies("medium");else if("id_pdf"===a.id)generate_from_md("pdf",m);else if("id_latex_export"===a.id)generate_from_md("latex",m);else if("id_epub"===a.id)generate_from_md("epub",m);else if("id_msw"===a.id)generate_from_md("msw",m);else if("id_publish_article"===a.id){e.getElementById("transFrame").addEventListener("load",function(){t.location.reload(!0)})}})}(document,window);