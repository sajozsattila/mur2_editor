function MarkdownParser(n){n=n?"i":"";var e,r=null,t=null,i={},a={},s={},o={},u={},l={},d={};function c(e,r){var t=new RegExp("^("+e+")$",n);i[r]=t,a[r]=t}function f(e,r){var t=new RegExp("^("+e+")$",n);i[r]=t,s[r]=t}function h(e,r,t){l[t]||(l[t]={}),l[t][r]=new RegExp("^("+e+")$",n)}function p(n,t,i,a){var s=r;if(t in e){if(null===e[t])return void a.push({token:n,block:t,line:i});s=d[t]}if(void 0!==u[t]){var o=n.match(u[t]);o[2]&&(a.push({token:o[1],block:t+"-mark",line:i}),n=o[2],i=0)}for(var l,c=n.split(s),f=0;f<c.length;f++)""!=(l=c[f])&&(a.push({token:l,block:t,line:i}),i=0)}function $(n,e){for(var r in e)if(e.hasOwnProperty(r)&&e[r].test(n))return r;return""}return this.addInlineRules=function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var a=e[i].source;t.push(a),f(a,i)}return r=new RegExp("("+t.join("|")+")",n),this},this.addSubRules=function(r){for(var t in e=r,r)if(r.hasOwnProperty(t)){var i=r[t],a=[];for(var s in i)if(i.hasOwnProperty(s)){var o=i[s].source;h(o,s,t),a.push(o)}d[t]=new RegExp("("+a.join("|")+")",n)}return this},this.addBlockRules=function(e){var r=[];for(var i in e)if(e.hasOwnProperty(i)){var a=e[i].source;r.push(a),c(a,i)}return t=new RegExp("("+r.join("|")+")",n),this},this.addRunIn=function(n){return o=n,this},this.addMarkers=function(n){return u=n,this},this.tokenize=function(n){var e,r,i=[],s=[],u=(n=n.replace("\r","")).split(t),l=u.length,d=0;for(e=0;e<l;e++)if(""!==u[e]){var c=$(u[e],a);if(d>0&&c in o){var f=o[c].allowedBlocks;if(f&&f.indexOf(r)>=0){u[d]+=u[e],u[e]="",s[e]="";continue}}s[e]=c,d=e,r=c}var h=0;for(e=0;e<l;e++){var v=u[e];if(""!==v){var k=0;"empty"!=s[e]&&(k=h,h=0),p(v,s[e],k,i),h+=substrCount("\n",v)}}return i},this.identifyInline=function(n){var r=n.block,t=s;if(r in e){if(null===e[r])return"";t=l[r]}return $(n.token,t)},this}var mdParser=new MarkdownParser;mdParser.addBlockRules({latexBlock:/[ \t]*\$\$\n?(?:[^\n]+\n)*(?:[^\n]*[^\\\n])?\$\$(?:[ \t]*\([ \t]*\S+[ \t]*\))?[ \t]*(?:\n|$)/,empty:/(?:[ \t]*\n)+/,fence:/```[\s\S]*?(?:$|```(?:\n|$))/,reference:/\[[^\]]+\]\:[^\n]*(?:\n|$)/,header:/#{1,6} [^\n]*(?:\n|$)/,header2:/[^\n]+\n[ \t]*[=-]{2,}(?:\n|$)/,rule:/(?:[\*]{3,}|[\-]{3,}|[\_]{3,})(?:\n|$)/,list:/[ ]{0,3}(?:[+\-\*]|\d+\.)[ \t]+[^\n]*(?:\n[ \t]*[^\n\t ]+[ \t]*)*(?:\n|$)/,quote:/[ ]{0,3}>[^\n]*(?:\n|$)/,paragraph:/[\s\S]*?(?:\n|$)/}).addInlineRules({latex:/\$\$(?:[\s\S]*?[^\\])?\$\$/,link:/\[.+?\][\(\[].*?[\)\]]/,bold:/(?:\s|^)__[\s\S]*?\S__|\*\*[\s\S]*?\S\*\*/,italic:/(?:\s|^)_[\s\S]*?[^\\\s]_|\*[^\\\s]\*|\*\S[\s\S]*?[^\\\s]\*/,ec_substitutions:/\{~~.+?~~\}/,ec_hlight:/\{==.+?==\}/,ec_delete:/\{--.+?--\}/,ec_add:/\{\+\+.+?\+\+\}/,ec_comment:/\{>>.+?<<\}/,strike:/~~.+?~~/,sup:/\^.+?\^/,sub:/~.+?~/,code:/``.+?``|`.*?[^`\\]`(?!`)/}).addSubRules({fence:null,rule:null,latexBlock:{comment:/%[^\n]*?(?=\$\$)|%[^\n]*/,reference:/[ \t]*\([ \t]*\S+[ \t]*\)[ \t\n]*$/,index:/(?:\^|_)(?:\\[a-zA-Zа-яА-я]+[\*]?(?:\{.*?\})|\{[a-zA-Zа-яА-я0-9]*?\}|[a-zA-Zа-яА-я0-9])/,bracket:/(?:(?:\\left|\\right)?[\{\}\[\]\(\)\|])/,keyword:/\\[a-zA-Zа-яА-я]+[\*]?/,keyword2:/\\[^a-zA-Zа-яА-я0-9]/,keyword3:/&/,delimeter:/\$\$/}}).addRunIn({paragraph:{allowedBlocks:["paragraph","quote","list"]}}).addMarkers({list:/^([ ]{0,3}(?:[+\-\*]|\d+\.)[ \t]+)([\s\S]*)$/,quote:/^([ ]{0,3}(?:>[ \t]*)+)([\s\S]*)$/});