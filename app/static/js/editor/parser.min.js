function MarkdownParser(n){n=n?"i":"";var r,e=null,t=null,i={},a={},s={},o={},u={},l={},f={};function d(r,e){var t=new RegExp("^("+r+")$",n);i[e]=t,a[e]=t}function c(r,e){var t=new RegExp("^("+r+")$",n);i[e]=t,s[e]=t}function h(r,e,t){l[t]||(l[t]={}),l[t][e]=new RegExp("^("+r+")$",n)}function p(n,t,i,a){var s=e;if(t in r){if(null===r[t])return void a.push({token:n,block:t,line:i});s=f[t]}if(void 0!==u[t]){var o=n.match(u[t]);o[2]&&(a.push({token:o[1],block:t+"-mark",line:i}),n=o[2],i=0)}for(var l,d=n.split(s),c=0;c<d.length;c++)""!=(l=d[c])&&(a.push({token:l,block:t,line:i}),i=0)}function $(n,r){for(var e in r)if(r.hasOwnProperty(e)&&r[e].test(n))return e;return""}return this.addInlineRules=function(r){var t=[];for(var i in r)if(r.hasOwnProperty(i)){var a=r[i].source;t.push(a),c(a,i)}return e=new RegExp("("+t.join("|")+")",n),this},this.addSubRules=function(e){for(var t in r=e,e)if(e.hasOwnProperty(t)){var i=e[t],a=[];for(var s in i)if(i.hasOwnProperty(s)){var o=i[s].source;h(o,s,t),a.push(o)}f[t]=new RegExp("("+a.join("|")+")",n)}return this},this.addBlockRules=function(r){var e=[];for(var i in r)if(r.hasOwnProperty(i)){var a=r[i].source;e.push(a),d(a,i)}return t=new RegExp("("+e.join("|")+")",n),this},this.addRunIn=function(n){return o=n,this},this.addMarkers=function(n){return u=n,this},this.tokenize=function(n){var r,e,i=[],s=[],u=(n=n.replace("\r","")).split(t),l=u.length,f=0;for(r=0;r<l;r++)if(""!==u[r]){var d=$(u[r],a);if(f>0&&d in o){var c=o[d].allowedBlocks;if(c&&c.indexOf(e)>=0){u[f]+=u[r],u[r]="",s[r]="";continue}}s[r]=d,f=r,e=d}var h=0;for(r=0;r<l;r++){var v=u[r];if(""!==v){var k=0;"empty"!=s[r]&&(k=h,h=0),p(v,s[r],k,i),h+=substrCount("\n",v)}}return i},this.identifyInline=function(n){var e=n.block,t=s;if(e in r){if(null===r[e])return"";t=l[e]}return $(n.token,t)},this}var mdParser=new MarkdownParser;mdParser.addBlockRules({latexBlock:/[ \t]*\$\$\n?(?:[^\n]+\n)*(?:[^\n]*[^\\\n])?\$\$(?:[ \t]*\([ \t]*\S+[ \t]*\))?[ \t]*(?:\n|$)/,empty:/(?:[ \t]*\n)+/,fence:/```[\s\S]*?(?:$|```(?:\n|$))/,reference:/\[[^\]]+\]\:[^\n]*(?:\n|$)/,header:/#{1,6} [^\n]*(?:\n|$)/,header2:/[^\n]+\n[ \t]*[=-]{2,}(?:\n|$)/,rule:/(?:[\*]{3,}|[\-]{3,}|[\_]{3,})(?:\n|$)/,list:/[ ]{0,3}(?:[+\-\*]|\d+\.)[ \t]+[^\n]*(?:\n[ \t]*[^\n\t ]+[ \t]*)*(?:\n|$)/,quote:/[ ]{0,3}>[^\n]*(?:\n|$)/,paragraph:/[\s\S]*?(?:\n|$)/}).addInlineRules({latex:/\$\$(?:[\s\S]*?[^\\])?\$\$/,link:/\[.+?\][\(\[].*?[\)\]]/,bold:/(?:\s|^)__[\s\S]*?\S__|\*\*[\s\S]*?\S\*\*/,italic:/(?:\s|^)_[\s\S]*?[^\\\s]_|\*[^\\\s]\*|\*\S[\s\S]*?[^\\\s]\*/,strike:/~~.+?~~/,sup:/\^.+?\^/,sub:/~.+?~/,code:/``.+?``|`.*?[^`\\]`(?!`)/}).addSubRules({fence:null,rule:null,latexBlock:{comment:/%[^\n]*?(?=\$\$)|%[^\n]*/,reference:/[ \t]*\([ \t]*\S+[ \t]*\)[ \t\n]*$/,index:/(?:\^|_)(?:\\[a-zA-Zа-яА-я]+[\*]?(?:\{.*?\})|\{[a-zA-Zа-яА-я0-9]*?\}|[a-zA-Zа-яА-я0-9])/,bracket:/(?:(?:\\left|\\right)?[\{\}\[\]\(\)\|])/,keyword:/\\[a-zA-Zа-яА-я]+[\*]?/,keyword2:/\\[^a-zA-Zа-яА-я0-9]/,keyword3:/&/,delimeter:/\$\$/}}).addRunIn({paragraph:{allowedBlocks:["paragraph","quote","list"]}}).addMarkers({list:/^([ ]{0,3}(?:[+\-\*]|\d+\.)[ \t]+)([\s\S]*)$/,quote:/^([ ]{0,3}(?:>[ \t]*)+)([\s\S]*)$/});