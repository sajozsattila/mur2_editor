function documentReady(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}function upload_source(){var e=document.getElementById("fileElem");(e.onclick||e.click||function(){}).call(e)}function upload_picture(){var e=document.getElementById("pictureElem");(e.onclick||e.click||function(){}).call(e)}function upload_bib(){var e=document.getElementById("bibliography");(e.onclick||e.click||function(){}).call(e)}async function msgclear(e){var t=document.getElementById("msg");200!=e?await sleep(5e3):await sleep(2e3),t.innerHTML=""}async function download_result(e){for(var t="",n=document.getElementById("title-source").value.replace(/\s/g,"_").toLowerCase(),a=e.length;a--;){t+="\n\n"+e[a].getDisplayedResult()}var r=g_view;if("html"===r||"htmltex"===r||"habr"===r||"src"===r){var o=new Blob([t],{type:"text/html; charset=UTF-8"});(l=document.createElement("a")).href=window.URL.createObjectURL(o),l.download=n+".html",l.style.display="none",document.body.appendChild(l),l.click(),delete l}else{var l;o=new Blob([t],{type:"text/markdown; charset=UTF-8"});(l=document.createElement("a")).href=window.URL.createObjectURL(o),l.download=n+".md",l.style.display="none",document.body.appendChild(l),l.click(),delete l}}function editorToolbarAction(e,t){if(null!==g_selectedTextarea){var n=document.getElementById(g_selectedTextarea),a=n.selectionStart,r=n.selectionEnd,o=n.value.substring(a,r),l="",s="";if(a!==r)l=""===o.slice(0,1).trim()?" ":"",s=""===o.slice(-1).trim()?" ":"";var i=null;if("italic"===e)i="*",wrap2=i;else if("strong"===e)i="**",wrap2=i;else if("heading"===e)i="\n# ",wrap2="\n";else if("code"===e)i="\n```\n",wrap2=i;else if("table"===e)i="\n|  |  |\n|--|--|\n|  |  |\n";else if("latex"===e)i="$$ ",wrap2=" $$";else if("link"===e){var d=prompt(_("Please enter a URL for the link."),"");null!=d&&(i=o?"["+o+"]("+d+")":"[link]("+d+")")}else"picture"===e?i=o?"!["+o+"]("+t+")":"![kep]("+t+")":"list"===e?(re=/\n/g,i="\n- "+o.replace(re,"\n- ")):"numbered_list"===e?(re=/\n/g,i="\n1. "+o.replace(re,"\n1. ")):"footnote"===e&&(i="^["+o+"] ");if(null!==i){var c=0;"italic"===e||"strong"===e||"code"===e||"latex"===e||"heading"===e?(n.value=n.value.substring(0,a)+l+i+o.trim()+wrap2+s+n.value.substring(r),c=a!==r?(i+wrap2).length:i.length):(n.value=n.value.substring(0,a)+l+i+s+n.value.substring(r),c=i.length-o.length),n.focus(),n.select(),n.selectionStart=a!==r?a:a+c,n.selectionEnd="footnote"===e&&a===r?r+c-2:r+c}}else alert(_("No field selected!"))}function sleep(e){return new Promise(t=>setTimeout(t,e))}async function alarming(e,t){var n=document.getElementById("msg");e.onload=function(){if(200!=e.status)alert(_("Error: ")+e.statusText+" - "+e.response);else{n.style.color="green",n.innerHTML=t;var a=JSON.parse(e.response);a.hasOwnProperty("id")&&window.location.replace("/edit/"+a.id)}},200!=e.status?await sleep(5e3):await sleep(2e3),n.innerHTML=""}function keywordlist(){for(var e=[],t=document.getElementById("keywords").getElementsByClassName("multi-search-item"),n=t.length;n--;)e.push(t[n].firstChild.firstChild.data);return e}function categorylist(){for(var e=[],t=document.getElementById("categories").getElementsByClassName("multi-search-item"),n=t.length;n--;)try{e.push(t[n].firstChild.firstChild.data)}catch(e){}return 0===e.length&&e.push("Uncategorized"),e}async function save_article(e){var t=new Blob([document.getElementById("main-source").value],{type:"text/html; charset=UTF-8"});try{var n=document.getElementById("article_main").innerHTML,a=new Blob([n],{type:"text/html; charset=UTF-8"}),r=document.getElementById("article_abstract").innerHTML,o=document.getElementById("article_title").innerHTML}catch(e){return void alert(_("You can only save in Preview mode!"))}var l=document.getElementById("textype").value;if(0===l.length&&(l="Article"),"Review"===l){if(reviewed=document.getElementById("reviewdArticle"),0==reviewed.value.length||isNaN(reviewed.value))return void alert(_("Choose the Article which you are reviewing!"));if(standby=document.getElementById("reviewStandby"),0==standby.value.length||isNaN(standby.value))return void alert(_("Need to set the Standby!"));if(standby.value<-100||standby.value>100)return void alert(_("Standby should be between +100 and -100!"));rebel=document.getElementById("reviewRebel").checked,console.log(rebel)}var s=new FormData,i=document.querySelector('meta[name="article_id"]').content,d=document.getElementById("title-source").value,c=document.getElementById("abstact-source").value,u="",m=document.getElementsByClassName("feature_image")[0];const p=new URL(m.baseURI);new URL(m.src).pathname!=p.pathname&&(u=m.src);var g=keywordlist(),v=categorylist(),w=document.getElementById("canonicalUrlText").value;0===w.trim().length&&(w="https://mur2.co.uk/reader/"+i),s.append("file",t),s.append("htmlfile",a,"article_text.html"),s.append("article_title_html",o),s.append("article_abstract_html",r),s.append("article_id",i),s.append("article_title",d),s.append("article_abstract",c),s.append("featuredimages",u),s.append("keywords",g.toString()),s.append("categories",v.toString()),s.append("article_url",w),s.append("article_textype",l),"Review"===l&&(s.append("reviewed",reviewed.value),s.append("standby",standby.value),s.append("rebel",rebel));var y=new XMLHttpRequest;y.open("post","/markdownsave",!0),y.send(s),alarming(y,_("Saved!"))}async function medium_connect(){var e=prompt("Please set the Integration tokens","");setCookie("mur2_medium_accesstoken",e,365),window.location.reload()}async function medium_on_fly(e,t,n){var a=document.getElementById("msg"),r=getCookie("mur2_medium_accesstoken"),o=n.getHtmlImg(),l=e.getHtmlImg().split("\n")[1].slice(3,-4),s=t.getHtmlImg(),i=document.querySelector('meta[name="article_id"]').content,d=keywordlist(),c=new FormData;c.append("acceskey",r),c.append("article_id",i),c.append("article_title",l),c.append("article_content",s+"<hr>"+o),c.append("destination","medium"),c.append("keywords",d.toString());var u=new XMLHttpRequest;u.open("post","/export_data",!0),u.send(c),u.onload=function(){if(200!=u.status)alert(_("Error: ")+u.statusText+" - "+u.response);else{var e=JSON.parse(u.response);a.style.color="green",a.innerHTML=_("Published on ")+e.link}}}async function wordpress2(e,t){fd=new FormData;var n=document.querySelector('meta[name="article_id"]').content;fd.append("article_id",n),fd.append("destination","wp"),fd.append("wpcom_id",t),fd.append("wpcom_address",e),xhr=new XMLHttpRequest,xhr.open("post","/export_data",!0),xhr.send(fd),alarming(xhr,_("Published on ")+e)}async function wordpress_on_fly(e,t,n){console.log("1");var a=document.getElementById("msg");if("Article"==document.querySelector('meta[name="texttype"]').content.trim()){var r=getCookie("mur2_wpc_accesstoken"),o=getCookie("mur2_wpc_sideid");""===r&&alert(_("Error: You are not logged into Wordpress.com"));document.querySelector('meta[name="article_id"]').content;for(var l=n.getHtmlImg(),s=e.getHtmlImg(),i=t.getHtmlImg(),d=(document.getElementsByClassName("feature_image")[0],keywordlist()),c=[],u=d.length;u--;){console.log(d[u]);let e=await new Promise(e=>{let t=new FormData,n=new XMLHttpRequest;t.append("name",d[u]),n.open("post","https://public-api.wordpress.com/wp/v2/sites/"+o+"/tags",!0),n.setRequestHeader("Authorization","Bearer "+decodeURIComponent(r)),n.onload=function(){e(n.response)},n.send(t)});var m=JSON.parse(e);"id"in m?c.push(m.id):"data"in m&&"term_id"in m.data&&c.push(m.data.term_id)}var p=new FormData;p.append("title",s),p.append("status","private"),p.append("content",i+"<hr>"+l),p.append("excerpt",i),p.append("format","standard"),p.append("tags",c);var g=new XMLHttpRequest;g.open("post","https://public-api.wordpress.com/wp/v2/sites/"+o+"/posts",!0),g.setRequestHeader("Authorization","Bearer "+decodeURIComponent(r)),g.send(p),g.onload=function(){if(201!=g.status)alert(_("Error: ")+g.statusText+" - "+g.response);else{var e=JSON.parse(g.response);a.style.color="green",a.innerHTML=_("Published on ")+e.link,wordpress2(e.link,e.id)}},200!=g.status?await sleep(5e3):await sleep(2e3),a.innerHTML=""}}async function generate_from_md(e,t){var n=document.getElementById("title-source").value,a=document.getElementById("abstact-source").value,r=new Blob([t.getSource()],{type:"text/markdown;charset=utf-8"}),o=document.querySelector('meta[name="endnotetext"]').content,l=document.querySelector('meta[name="mur2language"]').content,s=new FormData,i=document.getElementById("msg");i.innerHTML=_("Working..."),i.style.color="green";var d=document.querySelector('meta[name="author"]').content;s.append("destination",e),s.append("mdfile",r,"article_text.md"),s.append("article_title",n),s.append("article_abstract",a),s.append("endnotetext",o),s.append("language",l),s.append("author",d);var c=new XMLHttpRequest;c.responseType="blob",c.open("post","/export_data",!0),c.send(s),c.onload=function(){if(200!=c.status)alert(_("Error: ")+c.statusText+" - "+c.response);else{var t=this.response;window.URL=window.URL||window.webkitURL;var a=window.URL.createObjectURL(t);if("latex"===e||"epub"===e||"msw"===e){var r=document.createElement("a");r.href=window.URL.createObjectURL(t),n=n.replace(/\s/g,"_"),r.download="latex"===e?n+".tex":"msw"===e?n+".doc":n+".epub",r.style.display="none",document.body.appendChild(r),r.click(),delete r}else-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Macintosh")?window.location.href=a:window.open(a)}},200!=c.status?(await sleep(5e3),i.innerHTML=""):i.innerHTML=""}function multiSearchKeyup(e){var t=!1,n=!1;if(e.classList.contains("fa-close")?n=!0:13===event.keyCode?t=!0:"\\n"==e.value.slice(-2)&&(t=!0),t){var a=e.value;"\\n"==e.value.slice(-2)&&(a=e.value.slice(0,-2)),e.parentNode.insertBefore(function(e){const t=document.createElement("div");t.setAttribute("class","multi-search-item");const n=`<span>${e}</span>`;return t.innerHTML=n+'<div class="fa fa-close" onclick="multiSearchKeyup(this)"></div>',t}(a),e),e.value="",childrenNumber=e.parentNode.getElementsByClassName("multi-search-item"),childrenNumber.length>=10&&(e.parentNode.getElementsByTagName("input")[0].style.display="none")}else n&&e.parentNode.remove()}function selectReviewedID(){var e=document.getElementById("reviewModal"),t=document.getElementById("modalCloseReview");e.getElementsByClassName("modal-body")[0].innerHTML='<iframe id="editor_iframe" allowTransparency="true" frameborder="0" scrolling="yes"  src="/search" type= "text/javascript"></iframe>',e.style.display="block",t.onclick=function(){var t=document.getElementById("editor_iframe").contentWindow.document.getElementById("selected");reviewdArticle=document.getElementById("reviewdArticle"),reviewdArticle.value=t.innerHTML,e.style.display="none"},window.onclick=function(t){t.target==e&&(e.style.display="none")}}function addNewAuthor(e,t){var n;document.getElementById("msg");n="remove"===e?t:document.getElementById("newauthor").value;var a=document.querySelector('meta[name="article_id"]').content;workshares=document.getElementsByClassName("workshare");let r=0;for(var o={},l=0;l<workshares.length;l++)""!==workshares[l].value&&("remove"===e?workshares[l].getAttribute("userid")!==t&&(r+=parseInt(workshares[l].value),parseInt(workshares[l].getAttribute("original"))!==parseInt(workshares[l].value)&&(o[workshares[l].getAttribute("userid")]=parseInt(workshares[l].value))):(r+=parseInt(workshares[l].value),parseInt(workshares[l].getAttribute("original"))!==parseInt(workshares[l].value)&&(o[workshares[l].getAttribute("userid")]=parseInt(workshares[l].value))));if(100!==r)alert(_("Error: The sum of the workshare is not 100!"));else{var s=new FormData;s.append("newauthor",n),s.append("articleid",a),s.append("action",e),s.append("workshare",JSON.stringify(o));var i=new XMLHttpRequest;i.open("post","/addauthor",!0),i.send(s),i.onload=function(){200!=i.status?alert(_("Error: ")+i.statusText+" - "+i.response):location.reload()}}}function getArticleversion(){document.getElementById("msg");var e=document.getElementById("id_rollback_article_list"),t=e.options[e.selectedIndex].value;t=t.split("_");var n=new FormData;n.append("version",t[0]),n.append("article",t[1]);var a=new XMLHttpRequest;a.open("post","/getarticleversions",!0),a.send(n),a.onload=function(){if(200!=a.status)alert(_("Error: ")+a.statusText+" - "+a.response);else{var e=JSON.parse(a.response);document.getElementById("title-source").value=e.title,document.getElementById("abstact-source").value=e.abstract,document.getElementById("main-source").value=e.main;var t=document.getElementById("main-source"),n=new Event("input");t.dispatchEvent(n)}}}