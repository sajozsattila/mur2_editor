function documentReady(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}function upload_source(){var e=document.getElementById("fileElem");(e.onclick||e.click||function(){}).call(e)}async function download_result(e){for(var t="",n=e.length;n--;){t+="\n\n"+e[n].getDisplayedResult()}var a=g_view;if("html"===a||"htmltex"===a||"habr"===a||"src"===a){var r=new Blob([t],{type:"text/html; charset=UTF-8"});(o=document.createElement("a")).href=window.URL.createObjectURL(r),o.download=a+".html",o.style.display="none",document.body.appendChild(o),o.click(),delete o}else{var o;r=new Blob([t],{type:"text/markdown; charset=UTF-8"});(o=document.createElement("a")).href=window.URL.createObjectURL(r),o.download=a+".md",o.style.display="none",document.body.appendChild(o),o.click(),delete o}}function editorToolbarAction(e){if(null!==g_selectedTextarea){var t=document.getElementById(g_selectedTextarea),n=t.selectionStart,a=t.selectionEnd,r=t.value.substring(n,a),o="",l="";if(n!==a)o=""===r.slice(0,1).trim()?" ":"",l=""===r.slice(-1).trim()?" ":"";var s=null;if("italic"===e)s="*",wrap2=s;else if("strong"===e)s="**",wrap2=s;else if("heading"===e)s="\n# ",wrap2="\n";else if("code"===e)s="\n```\n",wrap2=s;else if("table"===e)s="\n|  |  |\n|--|--|\n|  |  |\n";else if("latex"===e)s="$$ ",wrap2=" $$";else if("link"===e){null!=(i=prompt(_("Please enter a URL for the link."),""))&&(s=r?"["+r+"]("+i+")":"[link]("+i+")")}else if("picture"===e){var i;null!=(i=prompt(_("Please enter a URL for image."),""))&&(s=r?"!["+r+"]("+i+")":"![kep]("+i+")")}else"list"===e?(re=/\n/g,s="\n- "+r.replace(re,"\n- ")):"numbered_list"===e?(re=/\n/g,s="\n1. "+r.replace(re,"\n1. ")):"footnote"===e&&(s="^["+r+"] ");if(null!==s){var d=0;"italic"===e||"strong"===e||"code"===e||"latex"===e||"heading"===e?(t.value=t.value.substring(0,n)+o+s+r.trim()+wrap2+l+t.value.substring(a),d=n!==a?(s+wrap2).length:s.length):(t.value=t.value.substring(0,n)+o+s+l+t.value.substring(a),d=s.length-r.length),t.focus(),t.select(),t.selectionStart=n!==a?n:n+d,t.selectionEnd="footnote"===e&&n===a?a+d-2:a+d}}else alert(_("No field selected!"))}function sleep(e){return new Promise(t=>setTimeout(t,e))}async function alarming(e,t){var n=document.getElementById("msg");e.onload=function(){if(200!=e.status)n.style.color="red",n.innerHTML=_("Error: ")+e.statusText+" - "+e.response;else{n.style.color="green",n.innerHTML=t;var a=JSON.parse(e.response);a.hasOwnProperty("id")&&window.location.replace("/edit/"+a.id)}},200!=e.status?await sleep(5e3):await sleep(2e3),n.innerHTML=""}function keywordlist(){for(var e=[],t=document.getElementById("keywords").getElementsByClassName("multi-search-item"),n=t.length;n--;)e.push(t[n].firstChild.firstChild.data);return e}function categorylist(){for(var e=[],t=document.getElementById("categories").getElementsByClassName("multi-search-item"),n=t.length;n--;)try{e.push(t[n].firstChild.firstChild.data)}catch(e){}return 0===e.length&&e.push("Uncategorized"),e}async function save_article(e){var t=new Blob([document.getElementById("main-source").value],{type:"text/html; charset=UTF-8"});try{var n=document.getElementById("article_main").innerHTML,a=new Blob([n],{type:"text/html; charset=UTF-8"}),r=document.getElementById("article_abstract").innerHTML,o=document.getElementById("article_title").innerHTML}catch(e){return void alert(_("You can only save in Preview mode!"))}var l=document.getElementById("textype").value;if(0===l.length&&(l="Article"),"Review"===l){if(console.log("in"),reviewed=document.getElementById("reviewdArticle"),0==reviewed.value.length||isNaN(reviewed.value))return void alert(_("Choose the Article which you are reviewing!"));if(standby=document.getElementById("reviewStandby"),0==standby.value.length||isNaN(standby.value))return void alert(_("Need to set the Standby!"));rebel=document.getElementById("reviewRebel").checked,console.log(rebel)}var s=new FormData,i=document.querySelector('meta[name="article_id"]').content,d=document.getElementById("title-source").value,c=document.getElementById("abstact-source").value,u="",m=document.getElementsByClassName("feature_image")[0];m.src!=m.baseURI&&(u=m.src);var p=keywordlist(),g=categorylist(),v=document.getElementById("canonicalUrlText").value;0===v.trim().length&&(v="https://mur2.co.uk/reader/"+i),s.append("file",t),s.append("htmlfile",a,"article_text.html"),s.append("article_title_html",o),s.append("article_abstract_html",r),s.append("article_id",i),s.append("article_title",d),s.append("article_abstract",c),s.append("featuredimages",u),s.append("keywords",p.toString()),s.append("categories",g.toString()),s.append("article_url",v),s.append("article_textype",l),"Review"===l&&(s.append("reviewed",reviewed.value),s.append("standby",standby.value),s.append("rebel",rebel));var w=new XMLHttpRequest;w.open("post","/markdownsave",!0),w.send(s),alarming(w,_("Saved!"))}async function medium_connect(){var e=prompt("Please set the Integration tokens","");setCookie("mur2_medium_accesstoken",e,365),window.location.reload()}async function medium_on_fly(e,t,n){var a=document.getElementById("msg"),r=getCookie("mur2_medium_accesstoken"),o=n.getHtmlImg(),l=e.getHtmlImg().split("\n")[1].slice(3,-4),s=t.getHtmlImg(),i=document.querySelector('meta[name="article_id"]').content,d=keywordlist(),c=new FormData;c.append("acceskey",r),c.append("article_id",i),c.append("article_title",l),c.append("article_content",s+"<hr>"+o),c.append("destination","medium"),c.append("keywords",d.toString());var u=new XMLHttpRequest;u.open("post","/export_data",!0),u.send(c),u.onload=function(){if(200!=u.status)a.style.color="red",a.innerHTML=_("Error: ")+u.statusText+" - "+u.response;else{var e=JSON.parse(u.response);a.style.color="green",a.innerHTML=_("Published on ")+e.link}}}async function wordpress2(e,t){fd=new FormData;var n=document.querySelector('meta[name="article_id"]').content;fd.append("article_id",n),fd.append("destination","wp"),fd.append("wpcom_id",t),fd.append("wpcom_address",e),xhr=new XMLHttpRequest,xhr.open("post","/export_data",!0),xhr.send(fd),alarming(xhr,_("Published on ")+e)}async function wordpress_on_fly(e,t,n){console.log("1");var a=document.getElementById("msg");if("Article"==document.querySelector('meta[name="texttype"]').content.trim()){var r=getCookie("mur2_wpc_accesstoken"),o=getCookie("mur2_wpc_sideid");""===r&&(a.style.color="red",a.innerHTML=_("Error: You are not logged into Wordpress.com"));document.querySelector('meta[name="article_id"]').content;console.log("1");var l=n.getHtmlImg(),s=e.getHtmlImg(),i=t.getHtmlImg();document.getElementsByClassName("feature_image")[0];console.log("2");var d=keywordlist();console.log("3");for(var c=[],u=d.length;u--;){console.log(d[u]);let e=await new Promise(e=>{let t=new FormData,n=new XMLHttpRequest;t.append("name",d[u]),n.open("post","https://public-api.wordpress.com/wp/v2/sites/"+o+"/tags",!0),n.setRequestHeader("Authorization","Bearer "+decodeURIComponent(r)),n.onload=function(){e(n.response)},n.send(t)});var m=JSON.parse(e);"id"in m?c.push(m.id):"data"in m&&"term_id"in m.data&&c.push(m.data.term_id)}console.log("publishing");var p=new FormData;p.append("title",s),p.append("status","private"),p.append("content",i+"<hr>"+l),p.append("excerpt",i),p.append("format","standard"),p.append("tags",c);var g=new XMLHttpRequest;g.open("post","https://public-api.wordpress.com/wp/v2/sites/"+o+"/posts",!0),g.setRequestHeader("Authorization","Bearer "+decodeURIComponent(r)),g.send(p),g.onload=function(){if(201!=g.status)a.style.color="red",a.innerHTML=_("Error: ")+g.statusText+" - "+g.response;else{var e=JSON.parse(g.response);a.style.color="green",a.innerHTML=_("Published on ")+e.link,wordpress2(e.link,e.id)}},200!=g.status?await sleep(5e3):await sleep(2e3),a.innerHTML=""}}async function generate_from_md(e,t){var n=document.getElementById("title-source").value,a=document.getElementById("abstact-source").value,r=new Blob([t.getSource()],{type:"text/markdown;charset=utf-8"}),o=document.querySelector('meta[name="endnotetext"]').content,l=document.querySelector('meta[name="mur2language"]').content,s=new FormData,i=document.getElementById("msg");i.innerHTML=_("Working..."),i.style.color="green";var d=document.querySelector('meta[name="author"]').content;s.append("destination",e),s.append("mdfile",r,"article_text.md"),s.append("article_title",n),s.append("article_abstract",a),s.append("endnotetext",o),s.append("language",l),s.append("author",d);var c=new XMLHttpRequest;c.responseType="blob",c.open("post","/export_data",!0),c.send(s),c.onload=function(){if(200!=c.status)i.style.color="red",i.innerHTML="Error: "+c.statusText+" - "+c.response;else{var t=this.response;window.URL=window.URL||window.webkitURL;var a=window.URL.createObjectURL(t);if("latex"===e||"epub"===e||"msw"===e){var r=document.createElement("a");r.href=window.URL.createObjectURL(t),n=n.replace(/\s/g,"_"),r.download="latex"===e?n+".tex":"msw"===e?n+".doc":n+".epub",r.style.display="none",document.body.appendChild(r),r.click(),delete r}else-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Macintosh")?window.location.href=a:window.open(a)}},200!=c.status?(await sleep(5e3),i.innerHTML=""):i.innerHTML=""}function multiSearchKeyup(e){var t=!1,n=!1;if(e.classList.contains("fa-close")?n=!0:13===event.keyCode?t=!0:"\\n"==e.value.slice(-2)&&(t=!0),t){var a=e.value;"\\n"==e.value.slice(-2)&&(a=e.value.slice(0,-2)),e.parentNode.insertBefore(function(e){const t=document.createElement("div");t.setAttribute("class","multi-search-item");const n=`<span>${e}</span>`;return t.innerHTML=n+'<div class="fa fa-close" onclick="multiSearchKeyup(this)"></div>',t}(a),e),e.value="",childrenNumber=e.parentNode.getElementsByClassName("multi-search-item"),childrenNumber.length>=10&&(e.parentNode.getElementsByTagName("input")[0].style.display="none")}else n&&e.parentNode.remove()}function selectReviewedID(){var e=document.getElementById("reviewModal"),t=document.getElementById("modalCloseReview");e.getElementsByClassName("modal-body")[0].innerHTML='<iframe id="editor_iframe" allowTransparency="true" frameborder="0" scrolling="yes"  src="/embedding" type= "text/javascript"></iframe>',e.style.display="block",t.onclick=function(){var t=document.getElementById("editor_iframe").contentWindow.document.getElementById("selected");reviewdArticle=document.getElementById("reviewdArticle"),reviewdArticle.value=t.innerHTML,e.style.display="none"},window.onclick=function(t){t.target==e&&(e.style.display="none")}}function addNewAuthor(e,t){var n,a=document.getElementById("msg");n="remove"===e?t:document.getElementById("newauthor").value;var r=document.querySelector('meta[name="article_id"]').content;workshares=document.getElementsByClassName("workshare");let o=0;for(var l={},s=0;s<workshares.length;s++)""!==workshares[s].value&&("remove"===e?workshares[s].getAttribute("userid")!==t&&(o+=parseInt(workshares[s].value),parseInt(workshares[s].getAttribute("original"))!==parseInt(workshares[s].value)&&(l[workshares[s].getAttribute("userid")]=parseInt(workshares[s].value))):(o+=parseInt(workshares[s].value),parseInt(workshares[s].getAttribute("original"))!==parseInt(workshares[s].value)&&(l[workshares[s].getAttribute("userid")]=parseInt(workshares[s].value))));if(console.log(JSON.stringify(l)),console.log(n),console.log(r),console.log(e),100!==o)a.style.color="red",a.innerHTML=_("Error: The sum of the workshare is not 100!");else{var i=new FormData;i.append("newauthor",n),i.append("articleid",r),i.append("action",e),i.append("workshare",JSON.stringify(l));var d=new XMLHttpRequest;d.open("post","/addauthor",!0),d.send(i),d.onload=function(){200!=d.status?(a.style.color="red",a.innerHTML="Error: "+d.statusText+" - "+d.response):location.reload()}}}function getArticleversion(){var e=document.getElementById("msg"),t=document.getElementById("id_rollback_article_list"),n=t.options[t.selectedIndex].value;n=n.split("_");var a=new FormData;a.append("version",n[0]),a.append("article",n[1]);var r=new XMLHttpRequest;r.open("post","/getarticleversions",!0),r.send(a),r.onload=function(){if(200!=r.status)e.style.color="red",e.innerHTML="Error: "+r.statusText+" - "+r.response;else{var t=JSON.parse(r.response);document.getElementById("title-source").value=t.title,document.getElementById("abstact-source").value=t.abstract,document.getElementById("main-source").value=t.main;var n=document.getElementById("main-source"),a=new Event("input");n.dispatchEvent(a)}}}